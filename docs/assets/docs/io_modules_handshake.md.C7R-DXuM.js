import{_ as i,c as a,o as n,ag as l}from"./chunks/framework.BRWBV1zN.js";const g=JSON.parse('{"title":"Handshake","description":"","frontmatter":{},"headers":[],"relativePath":"io/modules/handshake.md","filePath":"io/modules/handshake.md","lastUpdated":1759447946000}'),p={name:"io/modules/handshake.md"};function e(h,s,k,t,r,d){return n(),a("div",null,s[0]||(s[0]=[l(`<h1 id="handshake" tabindex="-1">Handshake <a class="header-anchor" href="#handshake" aria-label="Permalink to &quot;Handshake&quot;">​</a></h1><p>El <em>handshake</em> es un dispotivo diseñado con el fin de facilitar la comunicación con las <a href="./../devices/printer.html">impresoras Centronics</a>. Está basado en el PPI 8255 de Intel en su modo &quot;1&quot;, pero con algunas modificaciones para simplificar su funcionamiento.</p><p>Este cuenta con dos registros de 8 bits:</p><ul><li>el registro de datos (dirección <code>40h</code> de la <a href="./index.html">memoria E/S</a>),</li><li>y el registro de estado (dirección <code>41h</code> de la <a href="./index.html">memoria E/S</a>).</li></ul><p>Específicamente,</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Datos  = DDDD DDDD</span></span>
<span class="line"><span>Estado = I___ __SB</span></span></code></pre></div><p>En el registro de datos se almacenará carácter a imprimir, expresado en ASCII. Cada vez que la CPU escriba sobre ese registro, el <em>handshake</em> se encargará de realizar un flanco ascendente en el <em>strobe</em> para que el carácter se imprima automáticamente.</p><p>En el registro de estado, los dos bits menos significativos son el <em>strobe</em> y <em>busy</em> (<a href="./../devices/printer.html">leer más sobre los mismos</a>), análogamente a como se usan en una impresora conectada con un PIO. La diferencia es que el bit de <em>busy</em> no puede ser modificado por la CPU y el bit de <em>strobe</em> siempre es <code>0</code>. Si la CPU trata de escribir un <code>1</code> en el bit de <em>strobe</em>, este causará un flanco ascendente en el <em>strobe</em>, enviando lo almacenado en el registro de datos, y el handshake lo volverá a <code>0</code> automáticamente.</p><p>Además, el bit más significativo del registro de estado habilita/inhabilita las interrupciones. Si este bit es <code>1</code>, mientras la impresora no esté ocupada (<code>B=0</code>), el Handshake disparará una interrupción por hardware. Está conectado al puerto <code>INT2</code> del <a href="./pic.html">PIC</a>.</p><div class="language-vonsim vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">vonsim</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; Imprime el string &quot;hola&quot; en la impresora usando Handshake</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dato </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">db</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Hola&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         ; String a imprimir, terminado en 0 (carácter nulo)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HS_DATA   </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">EQU</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 40h</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         ; Dirección del registro de datos del Handshake</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HS_STATUS </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">EQU</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 41h</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         ; Dirección del registro de estado del Handshake</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; --- Deshabilita las interrupciones del Handshake (bit 7 en 0) ---</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  al</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, HS_STATUS</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">and</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> al</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">01111111b</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         ; Fuerza el bit 7 a 0 (sin interrupciones)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HS_STATUS, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">al</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; --- Inicializa el puntero al string ---</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mov</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> bl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">offset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dato       </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; BL apunta al primer carácter del string</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; --- Bucle principal: espera espacio en el buffer e imprime ---</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sondeo:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  al</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, HS_STATUS</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    and</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> al</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">00000001b</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     ; Lee el flag busy (bit 0): 1=lleno, 0=libre</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    jz</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  imprimir_cadena   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; Si busy=0, hay espacio y puede imprimir</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    jmp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sondeo            </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; Si busy=1, espera hasta que haya espacio</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">imprimir_cadena:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    mov</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> al</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">bl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]          </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; Carga el siguiente carácter del string</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    cmp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> al</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             ; ¿Es el final del string? (carácter nulo)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    jz</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fin                </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; Si sí, termina el programa</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    out</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HS_DATA, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">al</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       ; Envía el carácter al registro de datos del Handshake</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    inc</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> bl</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                ; Avanza al siguiente carácter del string</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    jmp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sondeo            </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; Repite el proceso para el próximo carácter</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fin:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    hlt</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                   ; Detiene la ejecución</span></span></code></pre></div><p>Imprimir un string en la impresora a través del handshake en modo interrupciones</p><div class="language-vonsim vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">vonsim</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; ===============================================================================</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; PROGRAMA: Impresión de string usando Handshake con interrupciones</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; DESCRIPCIÓN: Imprime el string &quot;hola&quot; en la impresora utilizando el módulo</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">;              Handshake con interrupciones por hardware (INT2)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; ===============================================================================</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; --- SECCIÓN DE DATOS ---</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mensaje     </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">db</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Hola&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ; String a imprimir, terminado en carácter nulo</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">restantes   </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">db</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">           ; Contador de caracteres restantes por imprimir</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">puntero     </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">db</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">           ; Puntero al siguiente carácter (8 bits)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; --- CONSTANTES DE HANDSHAKE ---</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HS_DATA     </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">EQU</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 40h</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        ; Registro de datos del Handshake (puerto E/S)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">HS_STATUS   </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">EQU</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 41h</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        ; Registro de estado del Handshake (puerto E/S)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; --- CONSTANTES DE INTERRUPCIONES ---</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">ID          </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">EQU</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          ; ID de la interrupción para Handshake (0-7)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">IMR         </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">EQU</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 21h</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        ; Registro de máscara de interrupciones del PIC</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">EOI         </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">EQU</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 20h</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        ; Puerto para enviar End Of Interrupt al PIC</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">INT2        </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">EQU</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 26h</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        ; Puerto para configurar la línea INT2</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; ===============================================================================</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; PROGRAMA PRINCIPAL</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; ===============================================================================</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; --- 1) CONFIGURACIÓN INICIAL ---</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cli</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                        ; Deshabilitar interrupciones globales</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; --- 2) CONFIGURACIÓN DEL HANDSHAKE ---</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; Habilitar interrupciones del Handshake (bit 7 = 1)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  al</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, HS_STATUS         </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; Leer estado actual del Handshake</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">or</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  al</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10000000b</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         ; Activar bit 7 (habilitar interrupciones)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HS_STATUS, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">al</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         ; Escribir configuración al Handshake</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; --- 3) CONFIGURACIÓN DEL PIC (Controlador de Interrupciones) ---</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; 3.1) Configurar máscara de interrupciones - Solo habilitar INT2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mov</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> al</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">11111011b</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">         ; Máscara: habilita solo INT2 (bit 2=0), resto deshabilitado</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> IMR, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">al</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">               ; Aplicar máscara al PIC</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; 3.2) Asignar ID de interrupción a la línea INT2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mov</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> al</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ID                </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; Cargar ID de interrupción (2)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> INT2, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">al</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">              ; Configurar línea INT2 con este ID</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; 3.3) Configurar vector de interrupción en memoria</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mov</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> bl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, ID                </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; BL = posición en tabla de vectores (ID=2)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mov</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">bl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], int2_handler    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; Almacenar dirección de rutina en vector[2]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; --- 4) INICIALIZACIÓN DE VARIABLES ---</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mov</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> al</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">offset</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mensaje    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; AL = dirección del primer carácter del string</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mov</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> puntero, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">al</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">           ; Guardar en variable puntero</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; --- 5) ENVIAR PRIMER CARÁCTER PARA INICIAR EL PROCESO ---</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; Esperar que la impresora esté lista</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">esperar_listo:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    in</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> al</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, HS_STATUS</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    and</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> al</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">00000001b</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     ; Verificar bit busy</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    jnz</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> esperar_listo     </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; Si busy=1, esperar</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; Enviar primer carácter</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mov</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> bl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, puntero           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; Cargar puntero</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mov</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> al</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">bl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]              </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; Obtener primer carácter</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cmp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> al</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                 ; ¿Es string vacío?</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">jz</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fin                    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; Si está vacío, terminar</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">out</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HS_DATA, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">al</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">           ; Enviar primer carácter</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">inc</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> bl</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                    ; Avanzar puntero</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mov</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> puntero, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">bl</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">           ; Guardar puntero actualizado</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> restantes             </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; Decrementar contador</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; --- 6) HABILITAR INTERRUPCIONES Y ESPERAR ---</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sti</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                       ; Habilitar interrupciones globales</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; --- 7) BUCLE DE ESPERA ---</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; El programa principal espera hasta que se impriman todos los caracteres</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">bucle_espera:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    cmp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> restantes, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      ; ¿Quedan caracteres por imprimir?</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    jnz</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bucle_espera      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; Si quedan, seguir esperando</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; --- 8) FINALIZACIÓN ---</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fin:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hlt</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                       ; Detener ejecución del programa</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; ===============================================================================</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; RUTINA DE INTERRUPCIÓN INT2 - HANDSHAKE</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; ===============================================================================</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; DESCRIPCIÓN: Se ejecuta automáticamente cuando la impresora está lista</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">;              para recibir un nuevo carácter (busy = 0)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; ENTRADA: Variable puntero = dirección del siguiente carácter a imprimir</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; SALIDA: Carácter enviado a la impresora, puntero actualizado</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; ===============================================================================</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">org</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 80h</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">int2_handler:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ; --- PRESERVAR CONTEXTO ---</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    push</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> al</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">               ; Guardar registros que se van a modificar</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    push</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> bl</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ; --- VERIFICAR SI HAY MÁS CARACTERES ---</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    cmp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> restantes, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      ; ¿Quedan caracteres por imprimir?</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    jz</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fin_interrupcion   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; Si no quedan, terminar</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ; --- OBTENER SIGUIENTE CARÁCTER ---</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    mov</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> bl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, puntero       </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; BL = puntero al siguiente carácter</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    mov</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> al</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">bl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]          </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; AL = carácter apuntado por BL</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    cmp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> al</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             ; ¿Es el carácter nulo (fin de string)?</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    jz</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fin_interrupcion   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; Si es 0, terminar</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ; --- ENVIAR CARÁCTER A LA IMPRESORA ---</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    out</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> HS_DATA, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">al</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       ; Escribir carácter al registro de datos del Handshake</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ; --- ACTUALIZAR PUNTEROS Y CONTADORES ---</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    inc</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> bl</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                ; Avanzar al siguiente carácter</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    mov</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> puntero, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">bl</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       ; Guardar puntero actualizado</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    dec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> restantes         </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">; Decrementar contador de caracteres restantes</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fin_interrupcion:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ; --- ENVIAR EOI AL PIC ---</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    mov</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> al</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20h</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">           ; Señal de fin de interrupción</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    out</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> EOI, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">al</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">           ; Notificar al PIC</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ; --- RESTAURAR CONTEXTO ---</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    pop</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> bl</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                ; Restaurar registros preservados</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    pop</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> al</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ; --- RETORNO DE INTERRUPCIÓN ---</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    iret</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                  ; Retorno de interrupción</span></span></code></pre></div>`,12)]))}const E=i(p,[["render",e]]);export{g as __pageData,E as default};
